<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Class Notes - UIUC Turbolearn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- ===== MAJOR CHANGE #1: External CSS System ===== -->
  <!-- BEFORE: All styles were inline in a <style> tag with hardcoded colors -->
  <!-- NOW: Uses turbolearn-darkmode.css with CSS custom properties for light/dark mode support -->
  <link rel="stylesheet" href="{{ url_for('static', filename='turbolearn-darkmode.css') }}">
  
  <!-- ===== MAJOR CHANGE #2: Typography System ===== -->
  <!-- BEFORE: Used generic system fonts -->
  <!-- NOW: Uses Google Fonts (Merriweather for headings, Inter for body text) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Choices.js for searchable dropdowns -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <style>
    /* ===== MAJOR CHANGE #3: CSS Custom Properties (Variables) ===== */
    /* BEFORE: Colors were hardcoded like #1a1f2e, #667eea, rgba(26, 31, 51, 0.6) */
    /* NOW: Uses CSS variables that automatically change with light/dark mode:
       - var(--bg-paper): Main background
       - var(--bg-card): Card backgrounds
       - var(--text-primary): Main text color
       - var(--accent-terracotta): Primary accent color
       - var(--border-light): Subtle borders
       - var(--shadow-md): Consistent shadows
       These variables are defined in turbolearn-darkmode.css and change values
       when data-theme attribute switches between "light" and "dark"
    */
    
    /* Additional styles specific to the notes page that extend turbolearn-darkmode.css */
    
    /* Main page container */
    .notes-page {
      min-height: 100vh;
      padding: 40px 0;
      background: var(--bg-paper);
    }
    
    /* Page title */
    /* CHANGE: Now uses var(--font-serif) and var(--text-primary) instead of hardcoded values */
    /* CHANGE: Uses clamp() for responsive font sizing */
    .notes-title {
      font-family: var(--font-serif);
      font-size: clamp(2rem, 4vw, 2.8rem);
      font-weight: 900;
      margin-bottom: 32px;
      color: var(--text-primary);
      letter-spacing: -0.02em;
    }
    
    /* Filter section card */
    /* CHANGE: Background uses var(--bg-card) instead of rgba(26, 31, 51, 0.6) */
    /* CHANGE: Border uses var(--border-light) instead of rgba(102, 126, 234, 0.2) */
    /* CHANGE: Shadow uses var(--shadow-md) instead of hardcoded box-shadow */
    /* CHANGE: Border radius uses var(--radius-lg) for consistency */
    .filter-section {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 32px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-md);
    }
    
    /* Filter form layout */
    .filter-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .filter-row:last-child {
      margin-bottom: 0;
    }
    
    /* Form controls */
    /* CHANGE: All form elements now use CSS variables for colors */
    /* BEFORE: border: 1px solid rgba(102, 126, 234, 0.3) */
    /* NOW: border: 1px solid var(--border-light) */
    /* BEFORE: background: rgba(23, 27, 46, 0.8) */
    /* NOW: background: var(--bg-paper-dark) */
    select, input, textarea {
      padding: 12px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
      background: var(--bg-paper-dark);
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: var(--font-sans);
    }
    
    select:hover, input:hover, textarea:hover {
      border-color: var(--border-medium);
    }
    
    /* CHANGE: Focus state now uses accent color with consistent shadow */
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent-terracotta);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }
    
    select {
      min-width: 150px;
      cursor: pointer;
    }
    
    /* Search input */
    .search-input {
      flex: 1;
      min-width: 200px;
    }
    
    /* Buttons */
    /* CHANGE: Button styling now uses accent colors from theme */
    /* BEFORE: background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) */
    /* NOW: background: var(--accent-terracotta) - simpler, theme-aware */
    .btn-search {
      background: var(--accent-terracotta);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
      white-space: nowrap;
    }
    
    .btn-search:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-search:active {
      transform: translateY(0);
    }
    
    /* Note count badge */
    /* CHANGE: Uses theme colors instead of hardcoded purple */
    .note-count {
      background: var(--bg-paper-dark);
      padding: 8px 16px;
      border-radius: var(--radius-lg);
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
      border: 1px solid var(--border-light);
      margin-left: auto;
    }
    
    /* Note cards */
    /* CHANGE: Card backgrounds and borders now theme-aware */
    /* CHANGE: Hover effects use consistent shadow variables */
    .card {
      background: var(--bg-card);
      padding: 24px;
      border-radius: var(--radius-lg);
      margin-bottom: 20px;
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
    }
    
    .card:hover {
      transform: translateY(-2px);
      border-color: var(--border-medium);
      box-shadow: var(--shadow-md);
    }
    
    /* Note title */
    /* CHANGE: Uses serif font from theme system */
    .note-title {
      font-family: var(--font-serif);
      font-weight: 700;
      font-size: 22px;
      margin-bottom: 10px;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }
    
    /* Note metadata */
    .note-meta {
      font-size: 13px;
      color: var(--text-tertiary);
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    /* CHANGE: Meta tags now use accent color for consistency */
    .meta-tag {
      background: var(--bg-paper-dark);
      padding: 4px 12px;
      border-radius: var(--radius-lg);
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-terracotta);
      border: 1px solid var(--border-light);
    }
    
    /* Note body */
    .note-body {
      white-space: pre-wrap;
      line-height: 1.7;
      color: var(--text-secondary);
      font-size: 15px;
    }
    
    /* Create note section */
    .create-section {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 28px;
      margin-top: 40px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-md);
    }
    
    .section-title {
      font-family: var(--font-serif);
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text-primary);
    }
    
    /* Form layout */
    form textarea {
      width: 100%;
      min-height: 140px;
      resize: vertical;
      line-height: 1.6;
    }
    
    form input, form select {
      width: 100%;
    }
    
    form .two {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    @media(max-width: 900px) {
      form .two {
        grid-template-columns: 1fr;
      }
    }
    
    /* Empty state */
    .empty-state {
      text-align: center;
      color: var(--text-tertiary);
      margin: 60px 0;
      font-size: 16px;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    /* Note actions */
    .note-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-light);
    }
    
    /* Action buttons */
    .btn-small {
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    /* CHANGE: Edit button now uses accent-terracotta instead of purple gradient */
    .btn-edit {
      background: var(--accent-terracotta);
      color: white;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-edit:hover {
      opacity: 0.9;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    /* CHANGE: Delete button uses consistent red (not gradient) */
    /* Kept as hardcoded red since it's a universal danger color */
    .btn-delete {
      background: #dc2626;
      color: white;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-delete:hover {
      background: #b91c1c;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    /* CHANGE: Cancel button uses theme neutrals */
    .btn-cancel {
      background: var(--bg-paper-dark);
      color: var(--text-secondary);
      border: 1px solid var(--border-medium);
    }
    
    .btn-cancel:hover {
      background: var(--bg-paper);
      color: var(--text-primary);
    }
    
    /* Edit form */
    .edit-form {
      display: none;
      margin-top: 16px;
      padding: 16px;
      background: var(--bg-paper-dark);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
    }
    
    .edit-form.active {
      display: block;
    }
    
    .note-content.editing {
      display: none;
    }
    
    /* Load more button container */
    .load-more-container {
      text-align: center;
      margin: 20px 0;
    }
    
    /* Responsive */
    @media(max-width: 768px) {
      .notes-title {
        font-size: 32px;
      }
      
      .filter-section {
        padding: 16px;
      }
      
      .card {
        padding: 20px;
      }
      
      .note-actions {
        flex-wrap: wrap;
      }
      
      .filter-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      select {
        min-width: auto;
        width: 100%;
      }
      
      .note-count {
        margin-left: 0;
      }
    }

    /* ===== MODAL STYLES ===== */
    
    /* Modal overlay - dark background that covers entire page */
    .modal-overlay {
      display: none; /* Hidden by default */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    /* Show modal when active class is added */
    .modal-overlay.active {
      display: flex;
    }
    
    /* Modal content box */
    .modal-content {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-light);
      animation: modalSlideIn 0.3s ease;
    }
    
    /* Smooth slide-in animation */
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Modal header */
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px 28px;
      border-bottom: 1px solid var(--border-light);
    }
    
    .modal-title {
      margin: 0;
      font-family: var(--font-serif);
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    /* Close button (X) */
    .modal-close {
      background: none;
      border: none;
      font-size: 32px;
      color: var(--text-tertiary);
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
      line-height: 1;
    }
    
    .modal-close:hover {
      color: var(--text-primary);
    }
    
    /* Modal body */
    .modal-body {
      padding: 28px;
    }
    
    /* Form inside modal */
    .modal-body form input,
    .modal-body form select,
    .modal-body form textarea {
      width: 100%;
    }
    
    .modal-body form textarea {
      min-height: 140px;
    }

    /* Header search styling */
    .header-search-form {
      margin-right: 16px;
    }

    .header-search-input {
      padding: 8px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
      background: var(--bg-paper-dark);
      color: var(--text-primary);
      min-width: 250px;
      font-size: 14px;
    }

    .header-search-input:focus {
      outline: none;
      border-color: var(--accent-terracotta);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    /* Hide search on mobile */
    @media (max-width: 768px) {
      .header-search-form {
        display: none;
      }
    }

    /* ===== NEW SECTION CARDS ===== */

    .section-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
    }

    .section-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }

    .section-heading {
      font-family: var(--font-serif);
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      color: var(--text-primary);
    }

    .course-select {
      flex: 1;
      min-width: 200px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .section-header-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .course-select {
        min-width: auto;
        width: 100%;
      }
    }

    /* ===== CHOICES.JS THEME CUSTOMIZATION ===== */

    .choices {
      margin-bottom: 0;
    }

    /* Main dropdown container - FORCE theme colors */
    .choices__inner {
      background: var(--bg-paper-dark) !important;
      border: 1px solid var(--border-light) !important;
      border-radius: var(--radius-md);
      color: var(--text-primary) !important;
      padding: 10px 14px;
      min-height: 44px;
      font-size: 14px;
    }

    .choices__inner:hover {
      border-color: var(--border-medium) !important;
    }

    .choices.is-focused .choices__inner,
    .choices.is-open .choices__inner {
      border-color: var(--accent-terracotta) !important;
      box-shadow: 0 0 0 3px var(--accent-soft) !important;
    }

    /* Dropdown menu */
    .choices__list--dropdown {
      background: var(--bg-card) !important;
      border: 1px solid var(--border-light) !important;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      z-index: 100;
    }

    /* Individual dropdown items */
    .choices__list--dropdown .choices__item {
      color: var(--text-primary) !important;
      padding: 10px 14px;
      font-size: 14px;
    }

    .choices__item--selectable {
      transition: background 0.2s ease;
    }

    /* Highlighted item (hover/keyboard selection) */
    .choices__item--selectable.is-highlighted {
      background: var(--accent-soft) !important;
      color: var(--accent-terracotta) !important;
    }

    /* Search input inside dropdown */
    .choices__input {
      background: var(--bg-paper-dark) !important;
      color: var(--text-primary) !important;
      margin-bottom: 0;
      font-size: 14px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      padding: 8px;
    }

    .choices__input::placeholder {
      color: var(--text-tertiary) !important;
      opacity: 1;
    }

    /* Dropdown arrow */
    .choices[data-type*='select-one']::after {
      border-color: var(--text-secondary) transparent transparent transparent;
      margin-top: -2px;
    }

    .choices[data-type*='select-one'].is-open::after {
      border-color: transparent transparent var(--text-secondary) transparent;
      margin-top: -7px;
    }

    /* No results message */
    .choices__item--choice.has-no-choices {
      color: var(--text-tertiary) !important;
      background: var(--bg-card) !important;
    }

    /* Selected value display */
    .choices__list--single .choices__item {
      color: var(--text-primary) !important;
    }

  </style>

  <script>
    // Toggle edit form visibility
    function toggleEdit(noteId) {
      const editForm = document.getElementById('edit-form-' + noteId);
      const noteContent = document.getElementById('note-content-' + noteId);
      editForm.classList.toggle('active');
      noteContent.classList.toggle('editing');
    }
  </script>
</head>
<body>
  <!-- ===== MAJOR CHANGE #4: Added Header with Theme Toggle ===== -->
  <!-- BEFORE: Page started directly with content, no header -->
  <!-- NOW: Added consistent header from homepage with:
       - Logo that links back to home
       - Theme toggle button (moon/sun icon)
       This provides navigation and light/dark mode switching
  -->
  <header class="tl-header">
    <div class="tl-container">
      <nav class="tl-nav">
        <a href="{{ url_for('home') }}" class="tl-logo">
          <div class="tl-logo-mark">TL</div>
          <div class="tl-logo-text">
            <span class="tl-logo-main">UIUC Turbolearn</span>
            <span class="tl-logo-sub">Class Notes</span>
          </div>
        </a>

        <div class="tl-nav-actions">
          <!-- Search bar in header -->
          <form method="get" action="/notes-feed" class="header-search-form">
            <input 
              type="text" 
              name="search" 
              class="header-search-input"
              placeholder="üîç Search notes..." 
              value="{{ search_query or '' }}"
            >
          </form>
        
          <!-- Theme toggle -->
          <button class="theme-toggle" aria-label="Toggle dark mode">
            <span class="moon-icon">üåô</span>
            <span class="sun-icon">‚òÄÔ∏è</span>
          </button>
        </div>

        
      </nav>
    </div>
  </header>

  <!-- ===== Main Content (Functionality Unchanged) ===== -->
  <!-- All functionality below is the same as index.html, just with updated styling -->
  <div class="notes-page">
    <div class="tl-container">
      <div class="notes-title">üëã Welcome to UIUC Turbolearn!</div>

      <!-- Share Your Notes Section -->
      <div class="section-card">
        <div class="section-header-row">
          <h2 class="section-heading">üìù Share Your Notes</h2>
          <button class="btn btn-accent" onclick="openModal()">Add Note +</button>
        </div>
      </div>

      <!-- Find Your Course Section -->
      <div class="section-card">
        <h2 class="section-heading">üîç Find Your Course</h2>
        <form method="get" action="/notes-feed" id="course-filter-form">
          <!-- Hidden fields to preserve other filters -->
          <input type="hidden" name="search" value="{{ search_query or '' }}">
          <input type="hidden" name="author_filter" value="{{ author_filter or 'All' }}">
          <input type="hidden" name="date_filter" value="{{ date_filter or 'All' }}">
          <input type="hidden" name="sort_by" value="{{ sort_by or 'recent' }}">
          
          <div style="display: flex; gap: 16px; margin-top: 16px;">
            <!-- Subject Dropdown -->
            <select id="subject-select" name="subject" class="course-select">
              <option value="">All Subjects</option>
            </select>
            
            <!-- Number Dropdown -->
            <select id="number-select" name="number" class="course-select">
              <option value="">All Numbers</option>
            </select>
            
            <!-- Hidden field to store combined class value for backend -->
            <input type="hidden" name="class_filter" id="class-filter-hidden" value="{{ selected_filter or 'All' }}">
          </div>
        </form>
      </div>

      <!-- Posted Notes Section -->
      <div class="section-card">
        <div class="section-header-row">
          <h2 class="section-heading">üìö Posted Notes</h2>
          
          <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
            <!-- Note count -->
            <div class="note-count">{{ total }} notes</div>
            
            <!-- Date filter dropdown -->
            <form method="get" action="/notes-feed" style="margin: 0;">
              <!-- Preserve current filters -->
              <input type="hidden" name="search" value="{{ search_query or '' }}">
              <input type="hidden" name="class_filter" value="{{ selected_filter or 'All' }}">
              <input type="hidden" name="author_filter" value="{{ author_filter or 'All' }}">
              <input type="hidden" name="sort_by" value="{{ sort_by or 'recent' }}">
              
              <select name="date_filter" onchange="this.form.submit()">
                <option value="All" {% if date_filter == "All" %}selected{% endif %}>All Time</option>
                <option value="Today" {% if date_filter == "Today" %}selected{% endif %}>Today</option>
                <option value="Week" {% if date_filter == "Week" %}selected{% endif %}>This Week</option>
                <option value="Month" {% if date_filter == "Month" %}selected{% endif %}>This Month</option>
              </select>
            </form>
            
            <!-- Sort dropdown -->
            <form method="get" action="/notes-feed" style="margin: 0;">
              <!-- Preserve current filters -->
              <input type="hidden" name="search" value="{{ search_query or '' }}">
              <input type="hidden" name="class_filter" value="{{ selected_filter or 'All' }}">
              <input type="hidden" name="author_filter" value="{{ author_filter or 'All' }}">
              <input type="hidden" name="date_filter" value="{{ date_filter or 'All' }}">
              
              <select name="sort_by" onchange="this.form.submit()">
                <option value="recent" {% if sort_by == "recent" %}selected{% endif %}>Most Recent</option>
                <option value="oldest" {% if sort_by == "oldest" %}selected{% endif %}>Oldest First</option>
                <option value="title" {% if sort_by == "title" %}selected{% endif %}>Title (A-Z)</option>
                <option value="author" {% if sort_by == "author" %}selected{% endif %}>Author (A-Z)</option>
              </select>
            </form>
          </div>
        </div>
      </div>
   
      <!-- Notes Feed -->
      <div id="notes-container">
      {% for n in notes %}
      <div class="card">
        <!-- Note content -->
        <div id="note-content-{{ n.id }}" class="note-content">
          <div class="note-title">{{ n.title }}</div>
          <div class="note-meta">
            <span class="meta-tag">üë§ {{ n.author }}</span>
            <span class="meta-tag">üìÖ {{ n.created }}</span>
            <span class="meta-tag">üìö {{ n.class }}</span>
          </div>
          <div class="note-body">{{ n.body }}</div>
        </div>

        <!-- Edit form -->
        <div id="edit-form-{{ n.id }}" class="edit-form">
          <form method="POST" action="/edit/{{ n.id }}">
            <div style="margin-bottom: 12px;">
              <input type="text" name="title" value="{{ n.title }}" placeholder="Note title" required>
            </div>
            <div style="margin-bottom: 12px;">
              <input type="text" name="author" value="{{ n.author }}" placeholder="Author name">
            </div>
            <div style="margin-bottom: 12px;">
              <select name="class">
                {% for c in classes %}
                <option value="{{ c }}" {% if c == n.class %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
              </select>
            </div>
            <div style="margin-bottom: 12px;">
              <textarea name="body" placeholder="Note content" required>{{ n.body }}</textarea>
            </div>
            <div style="display: flex; gap: 10px;">
              <button type="submit" class="btn-small btn-edit">üíæ Save Changes</button>
              <button type="button" class="btn-small btn-cancel" onclick="toggleEdit('{{ n.id }}')">‚ùå Cancel</button>
            </div>
          </form>
        </div>

        <!-- Action buttons -->
        <div class="note-actions">
          <button class="btn-small btn-edit" onclick="toggleEdit('{{ n.id }}')">‚úèÔ∏è Edit</button>
          <form method="POST" action="/delete/{{ n.id }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this note?');">
            <button type="submit" class="btn-small btn-delete">üóëÔ∏è Delete</button>
          </form>
        </div>
      </div>
      {% endfor %}
      </div>

      <!-- Load More button -->
      {% if has_more %}
        <div class="load-more-container">
          <button id="load-more" class="btn-small btn-edit" onclick="loadMore()">‚¨áÔ∏è Load More</button>
        </div>
      {% endif %}

      <!-- Empty state -->
      {% if notes|length == 0 %}
        <div class="empty-state">
          <div class="empty-state-icon">üì≠</div>
          <div>No notes found matching your filters.</div>
          <div style="font-size: 14px; margin-top: 8px;">Try adjusting your search or filters.</div>
        </div>
      {% endif %}

    </div>
  </div>

  <!-- ===== MAJOR CHANGE #5: Theme Toggle Script ===== -->
  <!-- BEFORE: No theme switching capability -->
  <!-- NOW: Loads theme-toggle.js which handles light/dark mode switching
       - Persists user preference in localStorage
       - Updates data-theme attribute on <html> element
       - All CSS variables automatically respond to theme changes
  -->
  <script src="{{ url_for('static', filename='theme-toggle.js') }}"></script>

  <!-- Pagination script (unchanged from original) -->
  <script>
    let currentPage = parseInt("{{ page|default(1) }}", 10) || 1;
    async function loadMore() {
      currentPage += 1;
      const form = document.querySelector('.filter-form');
      const params = new URLSearchParams(new FormData(form));
      params.set('page', currentPage);
      const url = '/notes?' + params.toString();
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Network response was not ok');
        const data = await res.json();
        const container = document.getElementById('notes-container');
        container.insertAdjacentHTML('beforeend', data.html);
        if (!data.has_more) {
          const btn = document.getElementById('load-more');
          if (btn) btn.style.display = 'none';
        }
      } catch (err) {
        console.error('Failed to load more notes', err);
      }
    }
  </script>

  <script>
    // ===== MODAL FUNCTIONS =====
    
    function openModal() {
      const modal = document.getElementById('note-modal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }
    
    function closeModal() {
      const modal = document.getElementById('note-modal');
      modal.classList.remove('active');
      document.body.style.overflow = ''; // Restore scrolling
      
      // Clear the form
      const form = document.getElementById('create-note-form');
      form.reset();
    }
    
    // Close modal when clicking outside the modal content
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('note-modal');
      
      modal.addEventListener('click', function(e) {
        // If click is on the overlay (not the content box)
        if (e.target === modal) {
          closeModal();
        }
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          closeModal();
        }
      });
    });

    // ===== COURSE FILTER LOGIC =====
    
    // Get CLASSES array from Flask template
    const CLASSES = {{ classes | tojson }};
    
    // Parse classes into subjects and numbers
    function parseClasses() {
      const subjects = new Set();
      const classesBySubject = {};
      
      CLASSES.forEach(cls => {
        // Extract subject (letters) and number (digits)
        // Example: "CS124" -> subject="CS", number="124"
        const match = cls.match(/^([A-Z]+)(\d+)$/);
        if (match) {
          const subject = match[1];  // "CS"
          const number = match[2];    // "124"
          
          subjects.add(subject);
          
          if (!classesBySubject[subject]) {
            classesBySubject[subject] = [];
          }
          classesBySubject[subject].push(number);
        }
      });
      
      return {
        subjects: Array.from(subjects).sort(),
        classesBySubject: classesBySubject
      };
    }
    
    // Populate subject dropdown with unique subjects
    function populateSubjects() {
      const { subjects } = parseClasses();
      const subjectSelect = document.getElementById('subject-select');
      
      // Get current filter to restore selection
      const currentFilter = "{{ selected_filter }}";
      let currentSubject = "";
      
      // Extract subject from current filter (e.g., "CS124" -> "CS")
      if (currentFilter && currentFilter !== "All") {
        const match = currentFilter.match(/^([A-Z]+)(\d+)$/);
        if (match) {
          currentSubject = match[1];
        }
      }
      
      // Clear existing options (except "All Subjects")
      while (subjectSelect.options.length > 1) {
        subjectSelect.remove(1);
      }
      
      // Add each subject as an option
      subjects.forEach(subject => {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        
        // Set as selected if it matches current filter
        if (subject === currentSubject) {
          option.selected = true;
        }
        
        subjectSelect.appendChild(option);
      });
    }

    // Update number dropdown when subject changes
    function updateNumberDropdown(preserveSelection = false) {
      const { classesBySubject } = parseClasses();
      const subjectSelect = document.getElementById('subject-select');
      const numberSelect = document.getElementById('number-select');
      
      const selectedSubject = subjectSelect.value;
      
      // Get current filter to restore selection
      const currentFilter = "{{ selected_filter }}";
      let currentNumber = "";
      
      if (preserveSelection && currentFilter && currentFilter !== "All") {
        const match = currentFilter.match(/^([A-Z]+)(\d+)$/);
        if (match) {
          currentNumber = match[2];
        }
      }
      
      // Clear number dropdown
      numberSelect.innerHTML = '<option value="">All Numbers</option>';
      
      if (selectedSubject) {
        // Get numbers for selected subject
        const numbers = classesBySubject[selectedSubject] || [];
        numbers.sort((a, b) => parseInt(a) - parseInt(b));
        
        // Populate number dropdown
        numbers.forEach(number => {
          const option = document.createElement('option');
          option.value = number;
          option.textContent = number;
          
          // Set as selected if it matches current filter
          if (number === currentNumber) {
            option.selected = true;
          }
          
          numberSelect.appendChild(option);
        });
      }
    }
    
    // Update hidden field and submit form
    function applyClassFilter() {
      const subjectSelect = document.getElementById('subject-select');
      const numberSelect = document.getElementById('number-select');
      const hiddenInput = document.getElementById('class-filter-hidden');
      const form = document.getElementById('course-filter-form');
      
      const selectedSubject = subjectSelect.value;
      const selectedNumber = numberSelect.value;
      
      // Combine subject + number to create class filter
      if (selectedSubject && selectedNumber) {
        hiddenInput.value = selectedSubject + selectedNumber;  // e.g., "CS124"
      } else if (selectedSubject) {
        // If only subject selected, show all classes for that subject
        hiddenInput.value = 'All';  // We'll handle this differently in a moment
      } else {
        hiddenInput.value = 'All';
      }
      
      // Submit the form to apply filter
      form.submit();
    }

    // Initialize dropdowns when page loads
    let subjectChoice, numberChoice;
    
    document.addEventListener('DOMContentLoaded', function() {
      // Populate subjects
      populateSubjects();
      
      // Update numbers based on current selection (with preservation)
      updateNumberDropdown(true);
      
      // Initialize Choices.js on subject dropdown
      const subjectSelect = document.getElementById('subject-select');
      subjectChoice = new Choices(subjectSelect, {
        searchEnabled: true,
        searchPlaceholderValue: 'Type to search subjects...',
        itemSelectText: '',
        shouldSort: false,
        searchResultLimit: 20,
        removeItemButton: false
      });
      
      // Initialize Choices.js on number dropdown
      const numberSelect = document.getElementById('number-select');
      numberChoice = new Choices(numberSelect, {
        searchEnabled: true,
        searchPlaceholderValue: 'Type to search numbers...',
        itemSelectText: '',
        shouldSort: false,
        searchResultLimit: 20,
        removeItemButton: false
      });
      
      // Add event listener to subject dropdown
      subjectSelect.addEventListener('change', function() {
        updateNumberDropdown(false);
        
        // Destroy and reinitialize number Choices.js to reflect new options
        numberChoice.destroy();
        numberChoice = new Choices(numberSelect, {
          searchEnabled: true,
          searchPlaceholderValue: 'Type to search numbers...',
          itemSelectText: '',
          shouldSort: false,
          searchResultLimit: 20,
          removeItemButton: false
        });
        
        // If "All Subjects" selected, clear and submit
        if (!this.value) {
          document.getElementById('class-filter-hidden').value = 'All';
          document.getElementById('course-filter-form').submit();
        }
      });
      
      // Add event listener to number dropdown
      numberSelect.addEventListener('change', function() {
        // If "All Numbers" selected with a subject, just submit
        if (!this.value && subjectSelect.value) {
          document.getElementById('class-filter-hidden').value = 'All';
          document.getElementById('course-filter-form').submit();
        } else {
          applyClassFilter();
        }
      });
    });
    
    // test code
    console.log('Choices available?', typeof Choices !== 'undefined');
  </script>


<!-- ===== MODAL FOR CREATING NOTES ===== -->
  <div id="note-modal" class="modal-overlay">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h2 class="modal-title">‚úçÔ∏è Create New Note</h2>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      
      <!-- Modal Body with Form -->
      <div class="modal-body">
        <form method="POST" action="/notes-feed" id="create-note-form">
          <div class="two">
            <input type="text" name="author" placeholder="Your name (optional)">
            <input type="text" name="title" placeholder="Note title">
          </div>

          <div style="margin-top: 16px;">
            <select name="class">
              {% for c in classes %}
              <option value="{{ c }}">{{ c }}</option>
              {% endfor %}
            </select>
          </div>

          <div style="margin-top: 16px;">
            <textarea name="body" placeholder="Write your note..." required></textarea>
          </div>

          <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
            <button type="button" class="btn-small btn-cancel" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn-search">üìù Post Note</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  

</body>
</html>

</body>
</html>