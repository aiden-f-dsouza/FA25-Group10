<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Class Notes</title>
  <style>
    /* ===== BASE STYLES ===== */
    /* Sets up the overall page appearance with a modern dark theme */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 100%);
      color: #e4e6eb;
      margin: 0;
      min-height: 100vh;
      padding: 20px 0;
    }

    /* Main container that holds all content */
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* ===== HEADER ===== */
    /* Main title with gradient text effect */
    .title {
      font-size: 42px;
      font-weight: 800;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -1px;
    }

    /* ===== FILTER SECTION ===== */
    /* Container for all filter controls */
    .filter-section {
      background: rgba(26, 31, 51, 0.6);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 32px;
      border: 1px solid rgba(102, 126, 234, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    /* ===== FORM CONTROLS ===== */
    /* Styling for all input fields, dropdowns, and buttons */
    select, input, textarea {
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(102, 126, 234, 0.3);
      background: rgba(23, 27, 46, 0.8);
      color: #e4e6eb;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    /* Hover effect for input fields - adds glow */
    select:hover, input:hover, textarea:hover {
      border-color: rgba(102, 126, 234, 0.6);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* Focus state for better accessibility */
    select:focus, input:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    }

    /* Button styling with gradient background */
    button {
      cursor: pointer;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      font-weight: 600;
      color: white;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    /* Button hover effect - lifts up and brightens */
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    /* Button click effect - presses down */
    button:active {
      transform: translateY(0);
    }

    /* ===== NOTE CARDS ===== */
    /* Individual note card styling with glassmorphism effect */
    .card {
      background: rgba(26, 31, 51, 0.6);
      backdrop-filter: blur(10px);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 20px;
      border: 1px solid rgba(102, 126, 234, 0.2);
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    /* Card hover effect - lifts and glows */
    .card:hover {
      transform: translateY(-4px);
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
    }

    /* Note title within card */
    .note-title {
      font-weight: 700;
      font-size: 22px;
      margin-bottom: 10px;
      color: #ffffff;
      letter-spacing: -0.5px;
    }

    /* Metadata line (author, date, class) */
    .note-meta {
      font-size: 13px;
      color: #a0a3bd;
      margin-bottom: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Individual meta tags (class, author badges) */
    .meta-tag {
      background: rgba(102, 126, 234, 0.2);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: #667eea;
    }

    /* Note body text */
    .note-body {
      white-space: pre-wrap;
      line-height: 1.7;
      color: #d0d2e0;
      font-size: 15px;
    }

    /* ===== CREATE NOTE FORM ===== */
    /* Section for creating new notes */
    .create-section {
      background: rgba(26, 31, 51, 0.6);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 28px;
      margin-top: 40px;
      border: 1px solid rgba(102, 126, 234, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    /* Section title */
    .section-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #ffffff;
    }

    /* Full width for form inputs */
    form textarea {
      width: 100%;
      min-height: 140px;
      resize: vertical;
      line-height: 1.6;
    }

    form input, form select {
      width: 100%;
    }

    /* Two column grid for author and title inputs */
    /* Creates side-by-side layout on larger screens */
    form .two {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    /* Stack inputs vertically on medium and small screens */
    @media(max-width: 900px) {
      form .two {
        grid-template-columns: 1fr;
      }
    }

    /* Note count badge */
    .note-count {
      background: rgba(102, 126, 234, 0.2);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      color: #667eea;
      white-space: nowrap;
    }

    /* Empty state message */
    .empty-state {
      text-align: center;
      color: #6b7280;
      margin: 60px 0;
      font-size: 16px;
    }

    /* ===== EDIT/DELETE BUTTONS ===== */
    /* Action buttons for each note card */
    .note-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(102, 126, 234, 0.2);
    }

    /* Small button styling for edit/delete/cancel */
    .btn-small {
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    /* Edit button - blue/purple gradient */
    .btn-edit {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .btn-edit:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
    }

    /* Delete button - red gradient */
    .btn-delete {
      background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 101, 101, 0.3);
    }

    .btn-delete:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(245, 101, 101, 0.5);
    }

    /* Cancel button - gray */
    .btn-cancel {
      background: rgba(107, 114, 128, 0.6);
      color: white;
    }

    .btn-cancel:hover {
      background: rgba(107, 114, 128, 0.8);
    }

    /* Edit form container - hidden by default */
    .edit-form {
      display: none;
      margin-top: 16px;
      padding: 16px;
      background: rgba(23, 27, 46, 0.5);
      border-radius: 12px;
      border: 1px solid rgba(102, 126, 234, 0.3);
    }

    /* Show edit form when active */
    .edit-form.active {
      display: block;
    }

    /* Note content - hide when editing */
    .note-content.editing {
      display: none;
    }

    /* ===== RESPONSIVE DESIGN ===== */
    /* Adjusts layout for smaller screens (phones) */
    @media(max-width:768px) {
      .title { font-size: 32px; }
      form .two { grid-template-columns: 1fr; }
      .filter-section { padding: 16px; }
      .card { padding: 20px; }
      .note-actions { flex-wrap: wrap; }
    }
  </style>

  <script>
    // ===== JAVASCRIPT FOR EDIT FUNCTIONALITY =====
    // Toggles the edit form visibility for a specific note
    function toggleEdit(noteId) {
      // Get the edit form and note content elements
      const editForm = document.getElementById('edit-form-' + noteId);
      const noteContent = document.getElementById('note-content-' + noteId);

      // Toggle the 'active' class to show/hide edit form
      editForm.classList.toggle('active');
      // Toggle the 'editing' class to show/hide note content
      noteContent.classList.toggle('editing');
    }
  </script>
</head>
<body>
  <div class="container">
    <div class="title">üìö Class Notes</div>
 
    <!-- Filter and Search Bar -->
    <!-- This form contains all filters: class, author, date range, search, and sort options -->
    <div class="filter-section">
      <form method="get" action="/">

        <!-- Row 1: Main filters (Class, Author, Date Range, Sort) -->
        <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">

          <!-- Filter by class (CS124, MATH221, etc.) -->
          <select name="class_filter" onchange="this.form.submit()" style="min-width: 150px;">
            <option value="All" {% if selected_filter == "All" %}selected{% endif %}>All Classes</option>
            {% for c in classes %}
            <option value="{{ c }}" {% if selected_filter == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>

          <!-- Filter by author (shows all users who have posted notes) -->
          <select name="author_filter" onchange="this.form.submit()" style="min-width: 150px;">
            <option value="All" {% if author_filter == "All" %}selected{% endif %}>All Authors</option>
            {% for a in authors %}
            <option value="{{ a }}" {% if author_filter == a %}selected{% endif %}>{{ a }}</option>
            {% endfor %}
          </select>

          <!-- Filter by date range (today, this week, this month, all time) -->
          <select name="date_filter" onchange="this.form.submit()" style="min-width: 150px;">
            <option value="All" {% if date_filter == "All" %}selected{% endif %}>All Time</option>
            <option value="Today" {% if date_filter == "Today" %}selected{% endif %}>Today</option>
            <option value="Week" {% if date_filter == "Week" %}selected{% endif %}>This Week</option>
            <option value="Month" {% if date_filter == "Month" %}selected{% endif %}>This Month</option>
          </select>

          <!-- Sort options (how to order the results) -->
          <select name="sort_by" onchange="this.form.submit()" style="min-width: 150px;">
            <option value="recent" {% if sort_by == "recent" %}selected{% endif %}>Most Recent</option>
            <option value="oldest" {% if sort_by == "oldest" %}selected{% endif %}>Oldest First</option>
            <option value="title" {% if sort_by == "title" %}selected{% endif %}>Title (A-Z)</option>
            <option value="author" {% if sort_by == "author" %}selected{% endif %}>Author (A-Z)</option>
          </select>

          <!-- Note count display badge -->
          <div class="note-count" style="margin-left: auto;">
            {{ notes|length }} notes
          </div>
        </div>

        <!-- Row 2: Search bar -->
        <div style="display: flex; gap: 12px; align-items: center;">
          <!-- Text input for searching note titles and content -->
          <input type="text" name="search" placeholder="üîç Search notes..." value="{{ search_query or '' }}" style="flex: 1; min-width: 200px;">

          <!-- Submit button to apply search and filters -->
          <button type="submit" style="white-space: nowrap;">Search</button>
        </div>

      </form>
    </div>
 
    <!-- Notes Feed -->
    <!-- Each note is displayed as a card with title, metadata, and content -->
    {% for n in notes %}
    <div class="card">
      <!-- Note content (visible by default, hidden when editing) -->
      <div id="note-content-{{ n.id }}" class="note-content">
        <!-- Note title (clickable headline) -->
        <div class="note-title">{{ n.title }}</div>

        <!-- Metadata tags (author, date, class as badges) -->
        <div class="note-meta">
          <span class="meta-tag">üë§ {{ n.author }}</span>
          <span class="meta-tag">üìÖ {{ n.created }}</span>
          <span class="meta-tag">üìö {{ n.class }}</span>
        </div>

        <!-- Note content/body -->
        <div class="note-body">{{ n.body }}</div>
      </div>

      <!-- Edit form (hidden by default, shown when edit button is clicked) -->
      <div id="edit-form-{{ n.id }}" class="edit-form">
        <form method="POST" action="/edit/{{ n.id }}">
          <!-- Title input for editing -->
          <div style="margin-bottom: 12px;">
            <input type="text" name="title" value="{{ n.title }}" placeholder="Note title" required style="width: 100%;">
          </div>

          <!-- Author input for editing -->
          <div style="margin-bottom: 12px;">
            <input type="text" name="author" value="{{ n.author }}" placeholder="Author name" style="width: 100%;">
          </div>

          <!-- Class selector for editing -->
          <div style="margin-bottom: 12px;">
            <select name="class" style="width: 100%;">
              {% for c in classes %}
              <option value="{{ c }}" {% if c == n.class %}selected{% endif %}>{{ c }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Body textarea for editing -->
          <div style="margin-bottom: 12px;">
            <textarea name="body" placeholder="Note content" required style="width: 100%; min-height: 120px;">{{ n.body }}</textarea>
          </div>

          <!-- Action buttons for the edit form -->
          <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn-small btn-edit">üíæ Save Changes</button>
            <button type="button" class="btn-small btn-cancel" onclick="toggleEdit({{ n.id }})">‚ùå Cancel</button>
          </div>
        </form>
      </div>

      <!-- Action buttons (Edit and Delete) -->
      <div class="note-actions">
        <!-- Edit button - toggles the edit form -->
        <button class="btn-small btn-edit" onclick="toggleEdit({{ n.id }})">‚úèÔ∏è Edit</button>

        <!-- Delete button - removes the note -->
        <form method="POST" action="/delete/{{ n.id }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this note?');">
          <button type="submit" class="btn-small btn-delete">üóëÔ∏è Delete</button>
        </form>
      </div>
    </div>
    {% endfor %}

    <!-- Empty state message when no notes match filters -->
    {% if notes|length == 0 %}
      <div class="empty-state">
        <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
        <div>No notes found matching your filters.</div>
        <div style="font-size: 14px; margin-top: 8px;">Try adjusting your search or filters.</div>
      </div>
    {% endif %}
 
    <!-- Create Note Form -->
    <!-- Form for users to submit new notes to the platform -->
    <div class="create-section">
      <div class="section-title">‚úçÔ∏è Create New Note</div>

      <form method="POST" action="/">
        <!-- Author name and note title (side by side on desktop) -->
        <div class="two">
          <input type="text" name="author" placeholder="Your name (optional)">
          <input type="text" name="title" placeholder="Note title">
        </div>

        <!-- Class selector dropdown -->
        <div style="margin-top: 16px;">
          <select name="class">
            {% for c in classes %}
            <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Note content text area -->
        <div style="margin-top: 16px;">
          <textarea name="body" placeholder="Write your note..." required></textarea>
        </div>

        <!-- Submit button (aligned to right) -->
        <div style="margin-top: 20px; text-align: right;">
          <button type="submit">üìù Post Note</button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>